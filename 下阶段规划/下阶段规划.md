# 下阶段规划

## **智能日程与效能管理系统 - 演进路线图**

### **1. 阶段概述 (Executive Summary)**

为了将系统从一个基础的自动化工具升级为企业级的智能协作平台，我们制定了分阶段的演进路线。
*   **Phase II (当前焦点)**: 侧重于**后端逻辑的灵活性**，通过 T7 配置表实现业务参数的动态解耦。
*   **Phase III (下个里程碑)**: 侧重于**前端交互的深度与体验**，通过引入“飞书交互卡片”替代传统表单，实现**富文本（Markdown）日报**的无缝提交与存储。

---

## **Phase II: 动态配置集成 (Dynamic Configuration)**

本阶段的核心目标是将所有工作流的关键业务参数（如触发时间、业务阈值、消息模板等）与n8n工作流本身进行“技术解耦”。我们将通过改造现有工作流，使其在每次运行时，都主动从 `T7: 系统配置参数表` 读取最新的指令。

### **1. 核心技术方案**

*   **轮询触发 + 动态决策**: 工作流定时唤醒，从 T7 表读取配置（如“是否是周一”、“是否到8点”），自行决定是否继续执行。

### **2. T7 配置表扩展计划**

| 参数名 (parameter_name)        | 目标工作流 | 用途说明                                   | 当前建议值 (可修改)                               |
| :----------------------------- | :--------- | :----------------------------------------- | :------------------------------------------------ |
| `daily_reminder_time`          | **WF-02**  | [提醒] 每日提醒的触发小时 (24小时制)       | `21:00`                                           |
| `missed_deadline_time`         | **WF-03**  | [漏写] 漏写判定的触发小时 (24小时制)       | `08:00`                                           |
| `ai_analysis_trigger_day`      | **WF-05**  | [AI] AI分析每周执行的星期 (1=周一, 7=周日) | `1`                                               |
| `analysis_cycle_days`          | **WF-05**  | [AI] AI分析的数据周期（向前追溯天数）      | `7`                                               |
| `reminder_template`            | WF-02      | [提醒] 发送给员工的提醒消息模板            | `您好{name}，请记得提交{date}的日报...`           |
| `missed_notification_template` | WF-03      | [漏写] 发送给员工的漏写通知模板            | `您好{name}，系统发现您在{date}的日报尚未提交...` |

---

## **Phase III: 交互体验升级 - 日报卡片化 (Interactive Card Upgrade)**

### **1. 背景与痛点**

目前系统依赖“飞书多维表格表单”进行数据收集，存在以下核心痛点：
*   **富文本缺失**: 表单仅支持纯文本，无法支持**加粗**、*斜体*、[超链接](url)或代码块，导致日报排版混乱，重点不突出。
*   **交互割裂**: 用户需点击链接跳转至浏览器填写，打断了 IM 沉浸式体验。

### **2. 改造目标**

将日报提交入口从“网页表单”全面升级为“**飞书消息卡片 (Message Card)**”。
*   **所见即所得**: 用户在聊天窗口的卡片中直接填写。
*   **Markdown 支持**: 允许用户使用 Markdown 语法（如 `**重点**`、`- 列表`），系统自动解析并存储为多维表格的富文本格式。

### **3. 技术架构挑战与解决方案**

根据调研报告《飞书卡片与多维表格集成》，此次改造面临两大核心技术挑战：

#### **挑战 A: 数据结构的“根本性错位”**
*   **前端 (Card)**: 用户输入的是 **Markdown 字符串** (例如 `已完成 **API接口** 开发`)。
*   **后端 (Bitable)**: 多维表格 API 拒收 Markdown，仅接受严格的 **JSON Segment 数组** (例如 `[{