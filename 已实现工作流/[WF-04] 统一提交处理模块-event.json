{
  "name": "[WF-04] ç»Ÿä¸€æäº¤å¤„ç†æ¨¡å—-event",
  "nodes": [
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7481acae-6595-4d5c-8e7a-82ed2e53adb3",
              "leftValue": "={{ $('è·å– T2 è®°å½•è¯¦æƒ…').item.json.data.records[0].fields.submission_type }}",
              "rightValue": "è¡¥äº¤",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "ff8eef7c-9753-47d4-80e3-7e1a1de8ea74",
              "leftValue": "={{ $('è·å– T2 è®°å½•è¯¦æƒ…').item.json.data.records[0].fields.submission_type }}",
              "rightValue": "ä»…è¯´æ˜åŸå› ",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        944,
        -1440
      ],
      "id": "ba95eb29-50cf-416c-aa2b-76c86895aaa2",
      "name": "åˆ¤æ–­æäº¤ç±»å‹",
      "retryOnFail": true,
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "resource": "bitable",
        "operation": "bitable:table:record:search",
        "app_toke": "QXRxxxxxxxxxxxxxxxxxxxx",
        "table_id": "TABLE_ID_PLACEHOLDER",
        "body": "={\n  \"filter\": {\n    \"conjunction\": \"and\",\n    \"conditions\": [\n      {\n        \"field_name\": \"employee_ref\",\n        \"operator\": \"contains\",\n        \"value\": [\n          \"{{ $('æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯').first().json.data.items[0].record_id }}\"\n        ]\n      },\n      {\n        \"field_name\": \"missed_date\",\n        \"operator\": \"is\",\n        \"value\": [\n          \"ExactDate\",\n          \"{{ $('è·å– T2 è®°å½•è¯¦æƒ…').first().json.data.records[0].fields.report_date }}\"\n        ]\n      },\n      {\n        \"field_name\": \"status\",\n        \"operator\": \"is\",\n        \"value\": [\n          \"æ¼å†™\"\n        ]\n      }\n    ]\n  }\n}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        1184,
        -1456
      ],
      "id": "f4ba424c-0078-4ffc-8354-856da37fb62c",
      "name": "æŸ¥è¯¢æ¼å†™è®°å½•",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "feishuCredentialsApi": {
          "id": "CREDENTIAL_ID_PLACEHOLDER",
          "name": "Feishu Credentials account"
        }
      }
    },
    {
      "parameters": {
        "resource": "bitable",
        "operation": "bitable:table:record:update",
        "app_toke": "QXRxxxxxxxxxxxxxxxxxxxx",
        "table_id": "TABLE_ID_PLACEHOLDER",
        "record_id": "={{ $('æŸ¥è¯¢æ¼å†™è®°å½•').item.json.data.items[0].record_id }}",
        "body": "={\n  \"fields\": {\n    \"status\": \"{{ $('è·å– T2 è®°å½•è¯¦æƒ…').first().json.data.records[0].fields.submission_type === 'è¡¥äº¤' ? 'å·²è¡¥äº¤' : 'å·²è¯´æ˜åŸå› ' }}\",\n    \"resolving_submission_ref\": [\n      \"{{ $('è·å– T2 è®°å½•è¯¦æƒ…').first().json.data.records[0].record_id }}\"\n    ]\n  }\n}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        1376,
        -1456
      ],
      "id": "36f7a8bd-831f-4915-9fd4-1a0bc74539b5",
      "name": "æ›´æ–°æ¼å†™è®°å½•",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "feishuCredentialsApi": {
          "id": "CREDENTIAL_ID_PLACEHOLDER",
          "name": "Feishu Credentials account"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "message:send",
        "receive_id": "={{ $json.receiver_open_id }}",
        "msg_type": "interactive",
        "content": "={{ JSON.stringify($json.message_body) }}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        1776,
        -1456
      ],
      "id": "8ac929d8-e8cb-4611-9acb-648332dec31e",
      "name": "å‘é€æˆåŠŸç¡®è®¤",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "feishuCredentialsApi": {
          "id": "CREDENTIAL_ID_PLACEHOLDER",
          "name": "Feishu Credentials account"
        }
      }
    },
    {
      "parameters": {
        "resource": "bitable",
        "operation": "bitable:table:record:search",
        "app_toke": "QXRxxxxxxxxxxxxxxxxxxxx",
        "table_id": "TABLE_ID_PLACEHOLDER",
        "page_size": 1,
        "body": "={\n  \"filter\": {\n    \"conjunction\": \"and\",\n    \"conditions\": [\n      {\n        \"field_name\": \"open_id\",\n        \"operator\": \"is\",\n        \"value\": [\n          \"{{ $('è·å– T2 è®°å½•è¯¦æƒ…').item.json.data.records[0].fields.employee_person[0].id }}\"\n        ]\n      }\n    ]\n  }\n}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        1568,
        -2176
      ],
      "id": "75a094e2-8301-4b35-9b7f-8088d3accf8d",
      "name": "æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯",
      "retryOnFail": true,
      "executeOnce": false,
      "alwaysOutputData": true,
      "credentials": {
        "feishuCredentialsApi": {
          "id": "CREDENTIAL_ID_PLACEHOLDER",
          "name": "Feishu Credentials account"
        }
      }
    },
    {
      "parameters": {
        "resource": "bitable",
        "operation": "bitable:table:record:update",
        "app_toke": "QXRxxxxxxxxxxxxxxxxxxxx",
        "table_id": "TABLE_ID_PLACEHOLDER",
        "record_id": "={{ $('è·å– T2 è®°å½•è¯¦æƒ…').item.json.data.records[0].record_id }}",
        "body": "={\n  \"fields\": {\n    \"employee_ref\": [\n      \"{{ $('æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯').item.json.data.items[0].record_id }}\"\n    ]\n  }\n}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        1792,
        -2176
      ],
      "id": "c1d3db54-8ff0-41cc-a550-63dd60d7ba36",
      "name": "æ›´æ–° T2 employee_ref",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "feishuCredentialsApi": {
          "id": "CREDENTIAL_ID_PLACEHOLDER",
          "name": "Feishu Credentials account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "resource": "bitable",
        "operation": "bitable:table:record:search",
        "app_toke": "QXRxxxxxxxxxxxxxxxxxxxx",
        "table_id": "TABLE_ID_PLACEHOLDER",
        "body": "{\n  \"filter\": {\n    \"conjunction\": \"and\",\n    \"conditions\": [\n      {\n        \"field_name\": \"parameter_name\",\n        \"operator\": \"is\",\n        \"value\": [\"ADMIN_OPEN_IDS\"]\n      }\n    ]\n  }\n}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        1008,
        -1760
      ],
      "id": "1d44f5b2-9ee8-4f56-98e4-b0e7d2e02598",
      "name": "æŸ¥è¯¢ç®¡ç†å‘˜åå•",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "feishuCredentialsApi": {
          "id": "CREDENTIAL_ID_PLACEHOLDER",
          "name": "Feishu Credentials account"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "message:send",
        "receive_id": "={{ $json.receiver_open_id }}",
        "msg_type": "interactive",
        "content": "={{ JSON.stringify($json.message_body) }}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        1440,
        -1760
      ],
      "id": "e69542e0-0a78-401b-adf4-f2185306cbba",
      "name": "å‘ç®¡ç†å‘˜å‘é€æ—¥æŠ¥é€šçŸ¥",
      "credentials": {
        "feishuCredentialsApi": {
          "id": "CREDENTIAL_ID_PLACEHOLDER",
          "name": "Feishu Credentials account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "WEBHOOK_UUID_PLACEHOLDER_2",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -896,
        -1248
      ],
      "id": "9efbdb19-1c70-4f4a-a598-b5cd10ce34d3",
      "name": "Webhook",
      "webhookId": "WEBHOOK_UUID_PLACEHOLDER_2"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={ \"challenge\": \"{{ $json.body.challenge }}\"}",
        "options": {
          "responseCode": 200
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -560,
        -1440
      ],
      "id": "d4f41d60-e648-4682-a052-99368a698fac",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "2adc6b0e-1c6c-4230-aea4-aab7db463632",
              "leftValue": "={{ $json.body.challenge }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -720,
        -1248
      ],
      "id": "a2c7525d-953c-4bbb-b9dd-1c65e8903625",
      "name": "äº‹ä»¶è®¢é˜…éªŒè¯"
    },
    {
      "parameters": {
        "resource": "bitable",
        "operation": "bitable:table:record:get",
        "app_toke": "QXRxxxxxxxxxxxxxxxxxxxx",
        "table_id": "TABLE_ID_PLACEHOLDER",
        "record_id": "={{ $('Webhook').item.json.body.event.action_list[0].record_id }}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        1152,
        -2160
      ],
      "id": "c80c6bb2-29e6-4edf-8815-8535228db141",
      "name": "è·å– T2 è®°å½•è¯¦æƒ…",
      "credentials": {
        "feishuCredentialsApi": {
          "id": "CREDENTIAL_ID_PLACEHOLDER",
          "name": "Feishu Credentials account"
        }
      }
    },
    {
      "parameters": {
        "content": "# äº‹ä»¶è®¢é˜…æ¥æ”¶ä¸æ ¡éªŒ",
        "height": 464,
        "width": 608
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -944,
        -1488
      ],
      "typeVersion": 1,
      "id": "bf79b485-0f1d-4df2-a2c7-438804d2b283",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "# æ•°æ®æ¸…æ´—ä¸å…³è”",
        "height": 304,
        "width": 1104,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        848,
        -2256
      ],
      "typeVersion": 1,
      "id": "a79ba186-de72-4c7e-8d5b-d13c42037637",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "# æ¼å†™åˆ¤å®šå¤„ç†\n",
        "height": 304,
        "width": 1072,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        880,
        -1520
      ],
      "typeVersion": 1,
      "id": "dc7cec02-56ac-418e-952a-36127bf90f25",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "# é€šçŸ¥ç®¡ç†å‘˜",
        "height": 256,
        "width": 752,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        896,
        -1856
      ],
      "typeVersion": 1,
      "id": "9c99be6c-435e-45a2-bdd1-c6532243cfc9",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "jsCode": "// 1. è·å–æ ¸å¿ƒæ•°æ®ï¼šT2æ—¥æŠ¥ã€å‘˜å·¥ä¿¡æ¯ã€T1æ›´æ–°ç»“æœ\nconst t2Data = $('è·å– T2 è®°å½•è¯¦æƒ…').first().json.data.records[0];\nconst userInfo = $('è·å–é£ä¹¦ç”¨æˆ·ä¿¡æ¯').first().json.data.user;\nconst t1Update = $('æ›´æ–°æ¼å†™è®°å½•').item.json.data.record.fields;\n\n// 2. æå–å…³é”®ä¿¡æ¯\nconst submitterName = userInfo.name;\nconst reportDate = new Date(t2Data.fields.report_date).toLocaleDateString('zh-CN', { timeZone: 'Asia/Shanghai' });\nconst updateStatus = t1Update.status;\n\n// 3. å®šä¹‰é¢œè‰²æ˜ å°„ï¼ˆç”¨äºå¡ç‰‡æ¨¡æ¿ï¼‰\nlet templateColor = \"blue\"; \nswitch(updateStatus) {\n    case 'å·²è¡¥äº¤': templateColor = 'green'; break;\n    case 'å·²è¯´æ˜åŸå› ': templateColor = 'orange'; break;\n    default: templateColor = 'blue';\n}\n\n// 4. æ„å»ºå¡ç‰‡å†…å®¹\nconst messageCard = {\n    \"config\": {\n        \"wide_screen_mode\": true\n    },\n    \"header\": {\n        \"title\": {\n            \"content\": `âœ… æ¼å†™è®°å½•å¤„ç†ç¡®è®¤ - ${submitterName}`,\n            \"tag\": \"plain_text\"\n        },\n        \"template\": templateColor\n    },\n    \"elements\": [\n        {\n            \"tag\": \"div\",\n            \"text\": {\n                \"content\": `æ‚¨æäº¤çš„æ—¥æŠ¥å·²æˆåŠŸå¤„ç†å¹¶å…³è”ã€‚`,\n                \"tag\": \"lark_md\"\n            }\n        },\n        {\n            \"tag\": \"hr\"\n        },\n        {\n            \"tag\": \"div\",\n            \"fields\": [\n                {\n                    \"is_short\": true,\n                    \"text\": {\n                        \"content\": `**åº”äº¤æ—¥æœŸï¼š**\\n${reportDate}`,\n                        \"tag\": \"lark_md\"\n                    }\n                },\n                {\n                    \"is_short\": true,\n                    \"text\": {\n                        \"content\": `**å¤„ç†çŠ¶æ€ï¼š**\\n<font color='${templateColor}'>${updateStatus}</font>`,\n                        \"tag\": \"lark_md\"\n                    }\n                }\n            ],\n            \"tag\": \"div\"\n        },\n        {\n            \"tag\": \"hr\"\n        },\n        {\n            \"tag\": \"note\",\n            \"elements\": [\n                {\n                    \"tag\": \"plain_text\",\n                    \"content\": \"æ„Ÿè°¢æ‚¨çš„åŠæ—¶æäº¤ã€‚è‹¥çŠ¶æ€æœ‰è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ã€‚\"\n                }\n            ]\n        }\n    ]\n};\n\n// 5. è¿”å›å¾…å‘é€æ•°æ®\nreturn [{\n    json: {\n        // æ”¶ä»¶äºº open_id\n        receiver_open_id: userInfo.open_id,\n        // æ¶ˆæ¯ä½“\n        message_body: messageCard\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1552,
        -1456
      ],
      "id": "d6c83de8-b01d-471d-99cf-766d692d4f4f",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "jsCode": "// --- [ Code: æå–ç”¨æˆ· Open ID & Name (v3) ] ---\n\nconst webhookBody = $input.item.json.body;\n\n// 1. æå– operator_id ä¿¡æ¯ (æäº¤è€… ID)\nconst operatorId = webhookBody.event.operator_id;\nconst openId = operatorId.open_id;\nconst unionId = operatorId.union_id;\nconst userId = operatorId.user_id;\n\nlet userName = 'æœªçŸ¥ç”¨æˆ·'; // é»˜è®¤å€¼\n\n// 2. å°è¯•ä» action_list ä¸­æå– name\n// é£ä¹¦ bitable äº‹ä»¶ä¸­ï¼Œname é€šå¸¸åœ¨ action_list[0].after_value ä¸­ person å­—æ®µçš„ field_identity_value é‡Œ\nconst actionList = webhookBody.event.action_list;\nif (actionList && actionList.length > 0) {\n    const firstAction = actionList[0];\n    if (firstAction.after_value && Array.isArray(firstAction.after_value)) {\n        // æŸ¥æ‰¾äººå‘˜å­—æ®µ (fldZE4pRyn) \n        const personField = firstAction.after_value.find(field => field.field_id === 'fldZE4pRyn'); // å‡è®¾ fldZE4pRyn æ˜¯ employee_person å­—æ®µ ID\n        \n        if (personField && personField.field_identity_value && personField.field_identity_value.users) {\n            const users = personField.field_identity_value.users;\n            if (users.length > 0 && users[0].name) {\n                userName = users[0].name; // æå–å§“å\n            }\n        }\n    }\n}\n\n// 3. æ„å»ºè¾“å‡º Item (æ¨¡ä»¿ feishuNode:user:get çš„è¾“å‡ºç»“æ„)\nreturn [\n  {\n    json: {\n      // ä¾›åç»­èŠ‚ç‚¹çš„è¡¨è¾¾å¼å¼•ç”¨\n      user_open_id: openId,\n      user_union_id: unionId,\n      user_name: userName, \n      \n      // æ¨¡ä»¿ feishuNode:user:get çš„è¾“å‡ºç»“æ„ï¼Œç”¨äºå…¼å®¹ä¸‹æ¸¸ Code èŠ‚ç‚¹ (å¦‚ 'å‡†å¤‡ç®¡ç†å‘˜é€šçŸ¥å†…å®¹')\n      data: { \n          user: { \n              open_id: openId, \n              union_id: unionId,\n              name: userName \n          } \n      }\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        928,
        -2160
      ],
      "id": "50b34cc3-cca9-47f6-b82d-0184f4196a35",
      "name": "æå–ç”¨æˆ· Open ID"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7fb22e40-1747-447a-999a-e1a51cf33073",
              "leftValue": "={{ $json.data.records[0].fields.employee_ref.link_record_ids }}",
              "rightValue": "",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1360,
        -2160
      ],
      "id": "8059348e-af81-41f3-9a82-d88a00435073",
      "name": "If"
    },
    {
      "parameters": {
        "jsCode": "// --- [ æ¶ˆæ¯å¡ç‰‡æ„å»ºå¼•æ“ v4.0 - æ•°æ®æµä¿®æ­£ç‰ˆ ] ---\n\n// 1. ç…§å¸¸è·å–æ‰€æœ‰å¿…éœ€çš„ä¸Šæ¸¸æ•°æ® (ä½¿ç”¨ first() ç¡®ä¿è·å–åˆ°æœ€æ–°çš„æˆåŠŸæ‰§è¡Œç»“æœ)\nconst t2RawData = $('è·å– T2 è®°å½•è¯¦æƒ…').first().json.data.records[0];\nconst adminConfig = $('æŸ¥è¯¢ç®¡ç†å‘˜åå•').all();\n// ä¿®æ­£ï¼šå¼•ç”¨æ–°çš„ Code èŠ‚ç‚¹æ¥è·å–ç”¨æˆ·ä¿¡æ¯\nconst userInfo = $('æå–ç”¨æˆ· Open ID').first().json.data.user; \n\n// 2. æ£€æŸ¥å¹¶è·å–ç®¡ç†å‘˜åˆ—è¡¨ (é€»è¾‘ä¸å˜)\nif (adminConfig.length === 0 || !adminConfig[0].json.data.items[0]) {\n  return [];\n}\nconst adminOpenIdsString = adminConfig[0].json.data.items[0].fields.parameter_value[0].text;\nconst adminOpenIds = adminOpenIdsString.split(',');\n\n// 3. å®šä¹‰å¯Œæ–‡æœ¬æå–è¾…åŠ©å‡½æ•°\nconst extractPlainText = (richTextField) => {\n    if (!richTextField || !Array.isArray(richTextField)) {\n        return '';\n    }\n    // é£ä¹¦å¯Œæ–‡æœ¬æ•°ç»„ [{text: '...', type: 'text'}]\n    return richTextField.map(item => item.text).join('\\n'); \n};\n\n// 4. å®šä¹‰å­—æ®µIDåˆ°ä¸­æ–‡æ ‡é¢˜çš„æ˜ å°„ (ä¸å˜)\nconst fieldMap = {\n  work_content: \"æœ¬æ¬¡å·¥ä½œå†…å®¹\",\n  next_plan: \"ä¸‹é˜¶æ®µè§„åˆ’\",\n  workload_feeling: \"å·¥ä½œé‡èŠ‚å¥\",\n  assistance_detail: \"éœ€è¦ååŠ©è¯¦æƒ…\",\n  makeup_explanation: \"è¡¥äº¤/æ¼å†™è¯´æ˜\",\n  report_date: \"åº”äº¤æŠ¥å‘Šæ—¥æœŸ\"\n};\n\n// 5. é¢œè‰²æ˜ å°„å™¨ (ä¸å˜)\nconst colorMapper = (field, value) => {\n  let color = \"grey\";\n  if (field === 'submission_type') {\n    switch (value) {\n      case 'æ­£å¸¸æäº¤': color = 'green'; break;\n      case 'è¡¥äº¤': color = 'yellow'; break;\n      case 'ä»…è¯´æ˜åŸå› ': color = 'orange'; break;\n    }\n  }\n  if (field === 'workload_feeling') {\n    switch (value) {\n      case 'å°šæœ‰ä½™åŠ›': color = 'green'; break;\n      case 'èŠ‚å¥é€‚ä¸­': color = 'blue'; break;\n      case 'å‹åŠ›åå¤§': color = 'orange'; break;\n      case 'éš¾ä»¥æŒ‰æ—¶å®Œæˆç°æœ‰å·¥ä½œ': color = 'red'; break;\n    }\n  }\n  return `<font color='${color}'>${value}</font>`;\n};\n\n// 6. æå–æ ¸å¿ƒä¿¡æ¯å¹¶å¤„ç†å¯Œæ–‡æœ¬\nconst fields = {};\nconst rawFields = t2RawData.fields;\n\n// **æ ¸å¿ƒæ•°æ®æå–ä¸å¤„ç†**\nfields.work_content = extractPlainText(rawFields.work_content);\nfields.next_plan = extractPlainText(rawFields.next_plan);\nfields.makeup_explanation = extractPlainText(rawFields.makeup_explanation);\nfields.assistance_detail = extractPlainText(rawFields.assistance_detail);\n\n// éå¯Œæ–‡æœ¬å­—æ®µå¯ä»¥ç›´æ¥èµ‹å€¼\nfields.submission_type = rawFields.submission_type;\nfields.workload_feeling = rawFields.workload_feeling;\nfields.report_date = rawFields.report_date; // çº¯æ•°å­—æ—¶é—´æˆ³\nfields.need_assistance = rawFields.need_assistance; // å¸ƒå°”å€¼æˆ– null\n\nconst submitterName = userInfo.name;\nconst submissionType = fields.submission_type;\n\n// 7. åˆå§‹åŒ–æ¶ˆæ¯å¡ç‰‡çš„â€œå…ƒç´ â€æ•°ç»„ (ä¸å˜)\nconst cardElements = [];\n\n// 8. è¾…åŠ©å‡½æ•° - ä¿®æ”¹ä¸ºä»æ–°çš„ fields å¯¹è±¡ä¸­å–å€¼\nconst addFieldToCard = (fieldName, isColored = false) => {\n  const value = fields[fieldName];\n  // æ£€æŸ¥å€¼æ˜¯å¦ä¸º null, undefined, æˆ–ç©ºå­—ç¬¦ä¸²\n  if (value && String(value).trim() !== '') {\n    const title = fieldMap[fieldName];\n    let displayValue = isColored ? colorMapper(fieldName, value) : value;\n    if (fieldName === 'report_date') {\n      // æ—¥æœŸæ ¼å¼åŒ–\n      displayValue = new Date(value).toLocaleDateString('zh-CN', { timeZone: 'Asia/Shanghai' });\n    }\n    cardElements.push({\n      \"tag\": \"div\",\n      \"text\": { \"content\": `**${title}ï¼š**\\n${displayValue}`, \"tag\": \"lark_md\" }\n    });\n    cardElements.push({ \"tag\": \"hr\" });\n  }\n};\n\n// 9. æŒ‰é¡ºåºæ„å»ºå¡ç‰‡å…ƒç´  (é€»è¾‘ä¸å˜)\nconst coloredSubmissionType = colorMapper('submission_type', submissionType);\ncardElements.push({\n  \"tag\": \"div\",\n  \"text\": { \"content\": `**æäº¤ç±»å‹ï¼š** ${coloredSubmissionType}`, \"tag\": \"lark_md\" }\n});\ncardElements.push({ \"tag\": \"hr\" });\n\nif (submissionType === 'æ­£å¸¸æäº¤') {\n  addFieldToCard('work_content');\n  addFieldToCard('next_plan');\n  addFieldToCard('workload_feeling', true);\n} else {\n  addFieldToCard('report_date');\n  addFieldToCard('makeup_explanation');\n  addFieldToCard('work_content');\n  addFieldToCard('next_plan');\n  addFieldToCard('workload_feeling', true);\n}\n\n// 10. ååŠ©éœ€æ±‚é€»è¾‘ - ä¿®æ­£ä¸ºæ£€æŸ¥éç©ºå¸ƒå°”å€¼\nif (fields.need_assistance === true) {\n  cardElements.push({ \"tag\": \"div\", \"text\": { \"content\": \"**æ˜¯å¦éœ€ååŠ©ï¼š**âœ…\", \"tag\": \"lark_md\" } });\n  cardElements.push({ \"tag\": \"hr\" });\n  \n  addFieldToCard('assistance_detail'); // ååŠ©è¯¦æƒ…å·²åœ¨ step 6 ä¸­æå–ä¸ºçº¯æ–‡æœ¬\n}\n\n// 11. ç»„è£…æˆæœ€ç»ˆçš„é£ä¹¦æ¶ˆæ¯å¡ç‰‡JSON (ä¸å˜)\nconst messageCard = {\n  \"config\": { \"wide_screen_mode\": true },\n  \"header\": {\n    \"title\": { \"content\": `ã€æ—¥æŠ¥æäº¤ã€‘- ${submitterName}`, \"tag\": \"plain_text\" },\n    \"template\": \"blue\"\n  },\n  \"elements\": cardElements\n};\n\n// 12. ä¸ºæ¯ä¸€ä½ç®¡ç†å‘˜ç”Ÿæˆä¸€ä¸ªå¾…å‘é€ä»»åŠ¡ (ä¸å˜)\nreturn adminOpenIds.map(id => ({\n  json: {\n    receiver_open_id: id.trim(),\n    message_body: messageCard\n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1232,
        -1760
      ],
      "id": "4944851f-7d7b-48e9-96a1-9b0454d2fe86",
      "name": "å‡†å¤‡ç®¡ç†å‘˜é€šçŸ¥å†…å®¹",
      "retryOnFail": true,
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// 1. è·å– Webhook ä¼ å…¥çš„äº‹ä»¶æ•°æ®\nconst event = $input.item.json.body.event;\n// è·å–ç¬¬ä¸€ä¸ªåŠ¨ä½œ (é€šå¸¸é£ä¹¦ä¸€æ¬¡æ¨é€åŒ…å«ä¸€ä¸ªä¸»è¦åŠ¨ä½œ)\nconst action = event.action_list[0];\n\n// è·å–å˜æ›´åçš„å­—æ®µåˆ—è¡¨\nconst afterList = action.after_value; \n\n// ã€ä¿®å¤ç‚¹ã€‘è·å–å˜æ›´å‰çš„å­—æ®µåˆ—è¡¨\n// å¯¹äº 'record_added' (æ–°å¢) äº‹ä»¶ï¼Œbefore_value æ˜¯ undefinedã€‚\n// æˆ‘ä»¬ä½¿ç”¨ || [] å°†å…¶é»˜è®¤ä¸ºç©ºæ•°ç»„ï¼Œé˜²æ­¢ .find() æŠ¥é”™ã€‚\nconst beforeList = action.before_value || []; \n\n// 2. åœ¨â€œå˜æ›´åâ€åˆ—è¡¨ä¸­ï¼Œå¯»æ‰¾åŒ…å« \"users\" ä¿¡æ¯çš„å­—æ®µ (å³äººå‘˜å­—æ®µ)\n// æ³¨æ„ï¼šè¿™é‡Œå‡è®¾ä¸šåŠ¡ä¸Šåªå…³æ³¨ç¬¬ä¸€ä¸ªè¢«ä¿®æ”¹çš„äººå‘˜å­—æ®µ\nconst personFieldAfter = afterList.find(field => \n  field.field_identity_value && \n  field.field_identity_value.users && \n  field.field_identity_value.users.length > 0\n);\n\n// å¦‚æœå˜æ›´åæ²¡äººï¼ˆæ¯”å¦‚è¢«æ¸…ç©ºäº†ï¼Œæˆ–è€…æ ¹æœ¬æ²¡å¡«ï¼Œæˆ–è€…æ”¹çš„æ˜¯å…¶ä»–éäººå‘˜å­—æ®µï¼‰ï¼Œç›´æ¥è·³è¿‡\nif (!personFieldAfter) {\n  return { json: { valid_update: false, reason: \"å½“å‰å˜æ›´æœªæ¶‰åŠäººå‘˜å­—æ®µæˆ–äººå‘˜ä¸ºç©º\" } };\n}\n\n// 3. ã€æ ¸å¿ƒé€»è¾‘ã€‘å°è¯•è·å–è¯¥å­—æ®µåœ¨â€œå˜æ›´å‰â€çš„çŠ¶æ€\nconst fieldId = personFieldAfter.field_id;\n// å› ä¸º beforeList ç°åœ¨ä¿è¯æ˜¯æ•°ç»„äº†ï¼Œæ‰€ä»¥è¿™é‡Œå®‰å…¨äº†\nconst personFieldBefore = beforeList.find(field => field.field_id === fieldId);\n\n// æå–å˜æ›´åçš„ User ID (æ–°å‘˜å·¥çš„ User ID)\nconst userIdAfter = personFieldAfter.field_identity_value.users[0].user_id.user_id;\n\n// æå–å˜æ›´å‰çš„ User ID \n// å¦‚æœæ˜¯æ–°å¢è®°å½•ï¼Œæˆ–è€…ä¹‹å‰æ²¡å¡«äººï¼Œè¿™é‡Œéƒ½ä¼šæ˜¯ null\nlet userIdBefore = null;\nif (personFieldBefore && \n    personFieldBefore.field_identity_value && \n    personFieldBefore.field_identity_value.users && \n    personFieldBefore.field_identity_value.users.length > 0) {\n    userIdBefore = personFieldBefore.field_identity_value.users[0].user_id.user_id;\n}\n\n// 4. ã€å·®åˆ†æ‹¦æˆªã€‘åªæœ‰å½“ User ID ç¡®å®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰æ”¾è¡Œ\n// æ–°å¢è®°å½•æ—¶ï¼šuserIdAfter (æœ‰å€¼) !== userIdBefore (null)ï¼Œæ¡ä»¶æˆç«‹ï¼Œæ”¾è¡Œã€‚\n// ç¼–è¾‘è®°å½•ä¸”æœªæ”¹äººæ—¶ï¼šä¸¤è€…ç›¸ç­‰ï¼Œæ‹¦æˆªã€‚\nif (userIdAfter === userIdBefore) {\n    return { \n      json: { \n        valid_update: false, \n        reason: \"äººå‘˜å­—æ®µæœªå˜æ›´ï¼Œæ— éœ€é‡å†™\",\n        debug_diff: `Before: ${userIdBefore} -> After: ${userIdAfter}`\n      } \n    };\n}\n\n// 5. é€šè¿‡æ ¡éªŒï¼Œè¿”å›æå–çš„æ•°æ®\nconst targetUser = personFieldAfter.field_identity_value.users[0];\nreturn {\n  json: {\n    valid_update: true,\n    target_record_id: action.record_id,\n    target_open_id: targetUser.user_id.open_id,\n    target_user_id: targetUser.user_id.user_id,\n    target_name: targetUser.name\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        976,
        -976
      ],
      "id": "d8b400ee-67b2-4837-9af0-e48ca44ba71e",
      "name": "æå–å˜æ›´äººå‘˜ä¿¡æ¯"
    },
    {
      "parameters": {
        "content": "# T2",
        "height": 1232,
        "width": 1360,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        640,
        -2352
      ],
      "typeVersion": 1,
      "id": "16bfec70-e8d5-46e5-9508-d95f59602a85",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "30dd2057-7153-4db3-b53f-ce8c26621a73",
              "leftValue": "={{ $json.valid_update }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1184,
        -976
      ],
      "id": "4678b7ce-5a40-4b15-b428-db781cdf9157",
      "name": "æ ¡éªŒæœ‰æ•ˆæ€§"
    },
    {
      "parameters": {
        "resource": "bitable",
        "operation": "bitable:table:record:update",
        "app_toke": "QXRxxxxxxxxxxxxxxxxxxxx",
        "table_id": "TABLE_ID_PLACEHOLDER",
        "record_id": "={{ $('æå–å˜æ›´äººå‘˜ä¿¡æ¯').item.json.target_record_id }}",
        "body": "={\n  \"fields\": {\n    \"employee_id\": \"{{ $('æå–å˜æ›´äººå‘˜ä¿¡æ¯').item.json.target_user_id }}\",\n    \"open_id\": \"{{ $('æå–å˜æ›´äººå‘˜ä¿¡æ¯').item.json.target_open_id }}\"\n  }\n}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        1424,
        -992
      ],
      "id": "6f913737-fd0a-4cc5-b8b9-e65160566526",
      "name": "å›å†™å·¥å·ä¸OpenID",
      "credentials": {
        "feishuCredentialsApi": {
          "id": "CREDENTIAL_ID_PLACEHOLDER",
          "name": "Feishu Credentials account"
        }
      }
    },
    {
      "parameters": {
        "content": "# T5",
        "height": 240,
        "width": 848,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        784,
        -1040
      ],
      "typeVersion": 1,
      "id": "26e15ba4-ba16-4999-9b4e-9a1103debbae",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.event.table_id }}",
                    "rightValue": "TABLE_ID_PLACEHOLDER",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "9a158b5a-265c-4e63-9e44-50c9ab6e6be0"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "T2:æ—¥æŠ¥å†…å®¹è¡¨"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9a50b810-7687-40cb-b92f-79e625e0c1d5",
                    "leftValue": "={{ $json.body.event.table_id }}",
                    "rightValue": "TABLE_ID_PLACEHOLDER",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "T5:å‘˜å·¥ä¿¡æ¯è¡¨"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "dc84287a-b022-4566-9bd1-0c1d4b2394b7",
                    "leftValue": "={{ $json.body.event.table_id }}",
                    "rightValue": "TABLE_ID_PLACEHOLDER",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "T6:ç‰¹æ®Šæ—¥ç¨‹è¡¨"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -224,
        -1248
      ],
      "id": "92ad4412-3190-41f1-9325-0fd24b6fc3c6",
      "name": "Switch"
    },
    {
      "parameters": {
        "resource": "bitable",
        "operation": "bitable:table:record:get",
        "app_toke": "QXRxxxxxxxxxxxxxxxxxxxx",
        "table_id": "TABLE_ID_PLACEHOLDER",
        "record_id": "={{ $('Switch').item.json.body.event.action_list[0].record_id }}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        944,
        -560
      ],
      "id": "6621ec11-07ca-4330-b1b0-70f29ef62a79",
      "name": "è·å– T6 è®°å½•è¯¦æƒ…",
      "credentials": {
        "feishuCredentialsApi": {
          "id": "CREDENTIAL_ID_PLACEHOLDER",
          "name": "Feishu Credentials account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "07ef92d9-61e7-4d20-977f-d60f17cbb4aa",
              "leftValue": "={{ $('è·å– T6 è®°å½•è¯¦æƒ…').item.json.data.records[0].fields.approval_status }}",
              "rightValue": "å·²æ‰¹å‡†",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1200,
        -560
      ],
      "id": "b440f26f-f43e-47c3-9130-f0b63073121d",
      "name": "åˆ¤æ–­å®¡æ‰¹çŠ¶æ€",
      "notes": "æ˜¯å¦å·²æ‰¹å‡†?"
    },
    {
      "parameters": {
        "resource": "bitable",
        "operation": "bitable:table:record:search",
        "app_toke": "QXRxxxxxxxxxxxxxxxxxxxx",
        "table_id": "TABLE_ID_PLACEHOLDER",
        "body": "{\n  \"filter\": {\n    \"conjunction\": \"and\",\n    \"conditions\": [\n      {\n        \"field_name\": \"parameter_name\",\n        \"operator\": \"is\",\n        \"value\": [\"SPECIAL_SCHEDULE_CC_IDS\"]\n      }\n    ]\n  }\n}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        1456,
        -656
      ],
      "id": "6f892914-0f32-472f-91ec-079a385b9612",
      "name": "è·å–æŠ„é€é…ç½®",
      "credentials": {
        "feishuCredentialsApi": {
          "id": "CREDENTIAL_ID_PLACEHOLDER",
          "name": "Feishu Credentials account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// --- [ Code: ç‰¹æ®Šæ—¥ç¨‹æŠ„é€ç”Ÿæˆå™¨ (v1.3 ç»“æ„ä¿®æ­£ç‰ˆ) ] ---\n\n// 1. è·å– T6 æ•°æ® (è¿™æ˜¯è§¦å‘æºï¼Œæ•°æ®æ˜¯æ’å®šçš„)\n// ä½¿ç”¨ first() ç¡®ä¿è·å–åˆ°æœ€æ–°çš„ T6 è®°å½•å­—æ®µ\nconst t6Record = $('è·å– T6 è®°å½•è¯¦æƒ…').first().json.data.records[0].fields;\n\n// 2. è·å– T7 æ•°æ® (å½“å‰èŠ‚ç‚¹çš„è¾“å…¥)\n// ã€å…³é”®ä¿®æ­£ã€‘ï¼šé£ä¹¦ Search èŠ‚ç‚¹çš„è¾“å‡ºåŒ…è£¹åœ¨ data.items ä¸­\n// æˆ‘ä»¬å–ç¬¬ä¸€ä¸ªè¾“å…¥é¡¹ï¼ˆAPIå“åº”ï¼‰ï¼Œç„¶åæå–å†…éƒ¨çš„ items æ•°ç»„\nconst apiResponse = $input.first().json;\nconst configRecords = apiResponse.data?.items || [];\n\nif (configRecords.length === 0) {\n    // å¦‚æœæ²¡æŸ¥åˆ°é…ç½®è®°å½•ï¼Œç›´æ¥è¿”å›ç©ºæ•°ç»„ï¼Œä¸å‘é€\n    return [];\n}\n\n// 3. å‡†å¤‡ T6 ä¸šåŠ¡æ•°æ® (åªéœ€å¤„ç†ä¸€æ¬¡)\nconst applicantName = t6Record.employee_person?.[0]?.name || \"æœªçŸ¥å‘˜å·¥\";\nconst scheduleType = t6Record.schedule_type || \"æœªæŒ‡å®š\";\nconst dateTs = t6Record.schedule_change_date;\nconst dateStr = new Date(dateTs).toLocaleDateString('zh-CN', { timeZone: 'Asia/Shanghai' });\nconst reason = t6Record.reason?.[0]?.text || \"æ— \";\nconst approverName = t6Record.approver_person?.[0]?.name || \"ç³»ç»Ÿè‡ªåŠ¨\";\n\n// 4. æ„å»ºé€šç”¨æ¶ˆæ¯å¡ç‰‡å†…å®¹\nconst cardContent = {\n  \"config\": { \"wide_screen_mode\": true },\n  \"header\": {\n    \"title\": { \"content\": `ğŸ“‹ ç‰¹æ®Šæ—¥ç¨‹å®¡æ‰¹æŠ„é€ - ${applicantName}`, \"tag\": \"plain_text\" },\n    \"template\": \"turquoise\"\n  },\n  \"elements\": [\n    {\n      \"tag\": \"div\",\n      \"fields\": [\n        { \"is_short\": true, \"text\": { \"tag\": \"lark_md\", \"content\": `**ç±»å‹ï¼š**\\n${scheduleType}` } },\n        { \"is_short\": true, \"text\": { \"tag\": \"lark_md\", \"content\": `**æ—¥æœŸï¼š**\\n${dateStr}` } },\n        { \"is_short\": true, \"text\": { \"tag\": \"lark_md\", \"content\": `**å®¡æ‰¹äººï¼š**\\n${approverName}` } },\n        { \"is_short\": true, \"text\": { \"tag\": \"lark_md\", \"content\": `**ç”³è¯·äº‹ç”±ï¼š**\\n${reason}` } }\n      ]\n    },\n    { \"tag\": \"hr\" },\n    { \"tag\": \"note\", \"elements\": [{ \"tag\": \"plain_text\", \"content\": \"æ­¤æ¶ˆæ¯ä¸ºç³»ç»Ÿè‡ªåŠ¨æŠ„é€\" }] }\n  ]\n};\n\n// 5. å¤„ç†è¾“å…¥å¹¶åˆ†è£‚ (Fan Out)\nconst results = [];\n\n// éå†æŸ¥åˆ°çš„é…ç½®è®°å½•ï¼ˆé€šå¸¸åªæœ‰1æ¡ï¼‰\nfor (const record of configRecords) {\n    // ã€å…³é”®ä¿®æ­£ã€‘ï¼šç°åœ¨ record å°±æ˜¯ items æ•°ç»„é‡Œçš„å…ƒç´ ï¼Œå¯ä»¥ç›´æ¥è®¿é—® fields\n    const t7Fields = record.fields;\n    \n    // å®‰å…¨è¯»å– parameter_value\n    const ccIdsRaw = t7Fields.parameter_value?.[0]?.text || \"\";\n    \n    // æ¸…æ´— Open ID åˆ—è¡¨\n    const ccIds = ccIdsRaw.split(',').map(id => id.trim()).filter(id => id);\n\n    // ä¸ºæ¯ä¸ª ID ç”Ÿæˆä¸€ä¸ªæ–°çš„è¾“å‡º Item\n    for (const id of ccIds) {\n        results.push({\n            json: {\n                receiver_id: id,\n                msg_type: \"interactive\",\n                content: cardContent\n            }\n        });\n    }\n}\n\n// 6. è¿”å›æ‰€æœ‰åˆ†è£‚åçš„ä»»åŠ¡\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1664,
        -656
      ],
      "id": "263b435a-1815-4a07-8ed2-3888efccbe3d",
      "name": "å‡†å¤‡æŠ„é€é€šçŸ¥"
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "message:send",
        "receive_id": "={{ $json.receiver_id }}",
        "msg_type": "interactive",
        "content": "={{ JSON.stringify($json.content) }}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        1872,
        -656
      ],
      "id": "b8803b30-0de9-4518-8ccf-179dc485f3f1",
      "name": "å‘é€æŠ„é€é€šçŸ¥",
      "retryOnFail": false,
      "credentials": {
        "feishuCredentialsApi": {
          "id": "CREDENTIAL_ID_PLACEHOLDER",
          "name": "Feishu Credentials account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// --- [ Code: çŠ¶æ€å˜æ›´è¿‡æ»¤å™¨ (å…¨å±€æ¨¡å¼ç‰ˆ) ] ---\n\nconst TARGET_FIELD_ID = \"fldWrj9ezk\"; // å®¡æ‰¹çŠ¶æ€å­—æ®µID\nconst results = [];\n\n// éå†æ‰€æœ‰è¾“å…¥é¡¹ (å¯¹äº Webhook è§¦å‘ï¼Œé€šå¸¸åªæœ‰ 1 é¡¹)\nfor (const item of $input.all()) {\n    const event = item.json.body.event;\n    \n    // é˜²å¾¡æ€§ç¼–ç¨‹ï¼šç¡®ä¿ action_list å­˜åœ¨\n    if (!event.action_list || event.action_list.length === 0) continue;\n    \n    const action = event.action_list[0];\n    const afterList = action.after_value;\n    const beforeList = action.before_value;\n\n    // è¾…åŠ©å‡½æ•°\n    const getFieldValue = (list, fieldId) => {\n        if (!list) return null;\n        const field = list.find(f => f.field_id === fieldId);\n        return field ? field.field_value : null;\n    };\n\n    const valAfter = getFieldValue(afterList, TARGET_FIELD_ID);\n    const valBefore = getFieldValue(beforeList, TARGET_FIELD_ID);\n\n    // ã€æ ¸å¿ƒåˆ¤æ–­ã€‘\n    if (valAfter !== valBefore) {\n        // åªæœ‰çŠ¶æ€å˜äº†ï¼Œæ‰å°†è¯¥ item åŠ å…¥ç»“æœæ•°ç»„\n        results.push({\n            json: {\n                is_status_changed: true,\n                status_val_opt: valAfter,\n                // é€ä¼ åŸå§‹ bodyï¼Œä¾›ä¸‹æ¸¸ä½¿ç”¨\n                body: item.json.body \n            }\n        });\n    }\n    // å¦‚æœæ²¡å˜ï¼Œå°±ä¸ pushï¼Œç›¸å½“äºè¢«è¿‡æ»¤æ‰äº†\n}\n\n// è¿”å›ç»“æœæ•°ç»„ (å¦‚æœæ˜¯ç©ºçš„ï¼Œåç»­æµç¨‹å°±ä¼šè‡ªç„¶åœæ­¢ï¼Œä¸”ä¸æŠ¥é”™)\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        720,
        -560
      ],
      "id": "f78a085f-e7b7-4159-a4e2-c3a49b0a49c4",
      "name": "çŠ¶æ€å˜æ›´è¿‡æ»¤å™¨ (T6ä¸“ç”¨)"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{\"msg\": \"received\"}",
        "options": {
          "responseCode": 200
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -480,
        -1232
      ],
      "id": "82282dd8-d865-49f1-bfa2-5c0065d2e843",
      "name": "Respond to Webhook1"
    },
    {
      "parameters": {
        "content": "# T6",
        "height": 368,
        "width": 1536,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        624,
        -704
      ],
      "typeVersion": 1,
      "id": "e7fad277-ceef-4798-b85f-96cad36a629d",
      "name": "Sticky Note6"
    }
  ],
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "127.0.0.1:5678",
            "user-agent": "Go-http-client/1.1",
            "content-length": "5164",
            "content-type": "application/json;charset=utf-8",
            "unit": "eu_nc",
            "x-lark-request-nonce": "211759086",
            "x-lark-request-timestamp": "1765436578",
            "x-lark-signature": "92b9fceede772969d6520e1cb1dd9a6563f2d5002ecbdd9fd3bb872d557b873f",
            "x-request-id": "7582492210715135170",
            "accept-encoding": "gzip",
            "connection": "Keep-Alive"
          },
          "params": {},
          "query": {},
          "body": {
            "schema": "2.0",
            "header": {
              "event_id": "0b0aa556b0c7c18f617ebd86ccb51736",
              "token": "VERIFICATION_TOKEN_PLACEHOLDER",
              "create_time": "1765436577000",
              "event_type": "drive.file.bitable_record_changed_v1",
              "tenant_key": "TENANT_KEY_PLACEHOLDER",
              "app_id": "APP_ID_PLACEHOLDER"
            },
            "event": {
              "action_list": [
                {
                  "action": "record_edited",
                  "after_value": [
                    {
                      "field_id": "fldtzZF8Qz",
                      "field_value": "1764691200000"
                    },
                    {
                      "field_id": "fldUVf7GnS",
                      "field_value": "[{\"sequence\":\"5\",\"number\":\"special_schedule_005\"}]"
                    },
                    {
                      "field_id": "fldABHjgbO",
                      "field_value": "1764726403000"
                    },
                    {
                      "field_id": "fldIWLS5ne",
                      "field_identity_value": {
                        "users": [
                          {
                            "avatar_url": "https://s1-imfile.feishucdn.com/static-resource/v1/v3_00sb_5e7d485e-a94b-442e-807b-1649602b5b5g~?image_size=72x72&cut_type=default-face&quality=&format=jpeg&sticker_format=.webp",
                            "en_name": "å´å®¶äº®",
                            "name": "å´å®¶äº®",
                            "user_id": {
                              "open_id": "USER_OPEN_ID_PLACEHOLDER_2",
                              "union_id": "on_57be293b37d2494f467fd950b39fa799",
                              "user_id": "f5b7d8f3"
                            }
                          }
                        ]
                      },
                      "field_value": "{\"users\":[{\"userId\":\"7551306183477084162\",\"avatarUrl\":\"https://s1-imfile.feishucdn.com/static-resource/v1/v3_00sb_5e7d485e-a94b-442e-807b-1649602b5b5g~?image_size=72x72&cut_type=default-face&quality=&format=jpeg&sticker_format=.webp\",\"name\":\"å´å®¶äº®\",\"enName\":\"å´å®¶äº®\"}]}"
                    },
                    {
                      "field_id": "fldxboEcpu",
                      "field_identity_value": {
                        "users": [
                          {
                            "avatar_url": "https://s1-imfile.feishucdn.com/static-resource/v1/v3_00m9_5220e04c-f89e-478d-97cd-80a4a84f3a0g~?image_size=72x72&cut_type=default-face&quality=&format=jpeg&sticker_format=.webp",
                            "en_name": "åˆ˜ç‘",
                            "name": "åˆ˜ç‘",
                            "user_id": {
                              "open_id": "USER_OPEN_ID_PLACEHOLDER_1",
                              "union_id": "on_ceb2d67defe8f85f1a62a78f7cd432b5",
                              "user_id": "8311297b"
                            }
                          }
                        ]
                      },
                      "field_value": "{\"users\":[{\"notify\":false,\"department\":\"ç ”å‘ä¸äº¤ä»˜\",\"isExternal\":false,\"avatarUrl\":\"https://s1-imfile.feishucdn.com/static-resource/v1/v3_00m9_5220e04c-f89e-478d-97cd-80a4a84f3a0g~?image_size=72x72&cut_type=default-face&quality=&format=jpeg&sticker_format=.webp\",\"name\":\"åˆ˜ç‘\",\"enName\":\"åˆ˜ç‘\",\"not_notify\":true,\"displayName\":{\"i18n_value\":{\"zh_cn\":\"\",\"en_us\":\"\",\"ja_jp\":\"\"},\"value\":\"åˆ˜ç‘\"},\"userId\":\"7504242265284837395\"}]}"
                    },
                    {
                      "field_id": "fldWrj9ezk",
                      "field_value": "opt7pEDfce"
                    },
                    {
                      "field_id": "fldPCMHs1O",
                      "field_value": "opt0xCaHoT"
                    },
                    {
                      "field_id": "fldTjx2EWU",
                      "field_value": "[{\"type\":\"text\",\"text\":\"å‘çƒ§ï¼Œå¤´ç–¼\"}]"
                    },
                    {
                      "field_id": "fldoX30WEK",
                      "field_value": ""
                    }
                  ],
                  "before_value": [
                    {
                      "field_id": "fldWrj9ezk",
                      "field_value": "opt7pEDfce"
                    },
                    {
                      "field_id": "fldoX30WEK",
                      "field_value": ""
                    },
                    {
                      "field_id": "fldABHjgbO",
                      "field_value": "1764726403000"
                    },
                    {
                      "field_id": "fldIWLS5ne",
                      "field_identity_value": {
                        "users": [
                          {
                            "avatar_url": "https://s1-imfile.feishucdn.com/static-resource/v1/v3_00sb_5e7d485e-a94b-442e-807b-1649602b5b5g~?image_size=72x72&cut_type=default-face&quality=&format=jpeg&sticker_format=.webp",
                            "en_name": "å´å®¶äº®",
                            "name": "å´å®¶äº®",
                            "user_id": {
                              "open_id": "USER_OPEN_ID_PLACEHOLDER_2",
                              "union_id": "on_57be293b37d2494f467fd950b39fa799",
                              "user_id": "f5b7d8f3"
                            }
                          }
                        ]
                      },
                      "field_value": "{\"users\":[{\"userId\":\"7551306183477084162\",\"avatarUrl\":\"https://s1-imfile.feishucdn.com/static-resource/v1/v3_00sb_5e7d485e-a94b-442e-807b-1649602b5b5g~?image_size=72x72&cut_type=default-face&quality=&format=jpeg&sticker_format=.webp\",\"name\":\"å´å®¶äº®\",\"enName\":\"å´å®¶äº®\"}]}"
                    },
                    {
                      "field_id": "fldTjx2EWU",
                      "field_value": "[{\"text\":\"å‘çƒ§ï¼Œå¤´ç–¼.\",\"type\":\"text\"}]"
                    },
                    {
                      "field_id": "fldtzZF8Qz",
                      "field_value": "1764691200000"
                    },
                    {
                      "field_id": "fldUVf7GnS",
                      "field_value": "[{\"sequence\":\"5\",\"number\":\"special_schedule_005\"}]"
                    },
                    {
                      "field_id": "fldxboEcpu",
                      "field_identity_value": {
                        "users": [
                          {
                            "avatar_url": "https://s1-imfile.feishucdn.com/static-resource/v1/v3_00m9_5220e04c-f89e-478d-97cd-80a4a84f3a0g~?image_size=72x72&cut_type=default-face&quality=&format=jpeg&sticker_format=.webp",
                            "en_name": "åˆ˜ç‘",
                            "name": "åˆ˜ç‘",
                            "user_id": {
                              "open_id": "USER_OPEN_ID_PLACEHOLDER_1",
                              "union_id": "on_ceb2d67defe8f85f1a62a78f7cd432b5",
                              "user_id": "8311297b"
                            }
                          }
                        ]
                      },
                      "field_value": "{\"users\":[{\"avatarUrl\":\"https://s1-imfile.feishucdn.com/static-resource/v1/v3_00m9_5220e04c-f89e-478d-97cd-80a4a84f3a0g~?image_size=72x72&cut_type=default-face&quality=&format=jpeg&sticker_format=.webp\",\"notify\":false,\"displayName\":{\"i18n_value\":{\"en_us\":\"\",\"ja_jp\":\"\",\"zh_cn\":\"\"},\"value\":\"åˆ˜ç‘\"},\"not_notify\":true,\"department\":\"ç ”å‘ä¸äº¤ä»˜\",\"userId\":\"7504242265284837395\",\"name\":\"åˆ˜ç‘\",\"enName\":\"åˆ˜ç‘\",\"isExternal\":false}]}"
                    },
                    {
                      "field_id": "fldPCMHs1O",
                      "field_value": "opt0xCaHoT"
                    }
                  ],
                  "record_id": "recVzI8cBp"
                }
              ],
              "file_token": "QXRxxxxxxxxxxxxxxxxxxxx",
              "file_type": "bitable",
              "operator_id": {
                "open_id": "USER_OPEN_ID_PLACEHOLDER_2",
                "union_id": "on_57be293b37d2494f467fd950b39fa799",
                "user_id": "f5b7d8f3"
              },
              "revision": 213,
              "subscriber_id_list": [
                {
                  "open_id": "USER_OPEN_ID_PLACEHOLDER_3",
                  "union_id": "on_f5ea92e327c5ac6682711315522c246f",
                  "user_id": ""
                }
              ],
              "table_id": "TABLE_ID_PLACEHOLDER",
              "update_time": 1765436577
            }
          },
          "webhookUrl": "http://localhost:5678/webhook/WEBHOOK_UUID_PLACEHOLDER_2",
          "executionMode": "production"
        }
      }
    ]
  },
  "connections": {
    "åˆ¤æ–­æäº¤ç±»å‹": {
      "main": [
        [
          {
            "node": "æŸ¥è¯¢æ¼å†™è®°å½•",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æŸ¥è¯¢æ¼å†™è®°å½•": {
      "main": [
        [
          {
            "node": "æ›´æ–°æ¼å†™è®°å½•",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ›´æ–°æ¼å†™è®°å½•": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‘é€æˆåŠŸç¡®è®¤": {
      "main": [
        []
      ]
    },
    "æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯": {
      "main": [
        [
          {
            "node": "æ›´æ–° T2 employee_ref",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ›´æ–° T2 employee_ref": {
      "main": [
        [
          {
            "node": "åˆ¤æ–­æäº¤ç±»å‹",
            "type": "main",
            "index": 0
          },
          {
            "node": "æŸ¥è¯¢ç®¡ç†å‘˜åå•",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æŸ¥è¯¢ç®¡ç†å‘˜åå•": {
      "main": [
        [
          {
            "node": "å‡†å¤‡ç®¡ç†å‘˜é€šçŸ¥å†…å®¹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‘ç®¡ç†å‘˜å‘é€æ—¥æŠ¥é€šçŸ¥": {
      "main": [
        []
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "äº‹ä»¶è®¢é˜…éªŒè¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "äº‹ä»¶è®¢é˜…éªŒè¯": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è·å– T2 è®°å½•è¯¦æƒ…": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "å‘é€æˆåŠŸç¡®è®¤",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æå–ç”¨æˆ· Open ID": {
      "main": [
        [
          {
            "node": "è·å– T2 è®°å½•è¯¦æƒ…",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‡†å¤‡ç®¡ç†å‘˜é€šçŸ¥å†…å®¹": {
      "main": [
        [
          {
            "node": "å‘ç®¡ç†å‘˜å‘é€æ—¥æŠ¥é€šçŸ¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æå–å˜æ›´äººå‘˜ä¿¡æ¯": {
      "main": [
        [
          {
            "node": "æ ¡éªŒæœ‰æ•ˆæ€§",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ ¡éªŒæœ‰æ•ˆæ€§": {
      "main": [
        [
          {
            "node": "å›å†™å·¥å·ä¸OpenID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "æå–ç”¨æˆ· Open ID",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "æå–å˜æ›´äººå‘˜ä¿¡æ¯",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "çŠ¶æ€å˜æ›´è¿‡æ»¤å™¨ (T6ä¸“ç”¨)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è·å– T6 è®°å½•è¯¦æƒ…": {
      "main": [
        [
          {
            "node": "åˆ¤æ–­å®¡æ‰¹çŠ¶æ€",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆ¤æ–­å®¡æ‰¹çŠ¶æ€": {
      "main": [
        [
          {
            "node": "è·å–æŠ„é€é…ç½®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è·å–æŠ„é€é…ç½®": {
      "main": [
        [
          {
            "node": "å‡†å¤‡æŠ„é€é€šçŸ¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‡†å¤‡æŠ„é€é€šçŸ¥": {
      "main": [
        [
          {
            "node": "å‘é€æŠ„é€é€šçŸ¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "çŠ¶æ€å˜æ›´è¿‡æ»¤å™¨ (T6ä¸“ç”¨)": {
      "main": [
        [
          {
            "node": "è·å– T6 è®°å½•è¯¦æƒ…",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Respond to Webhook1": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "ab098031-cfac-4530-961c-a947dff7a47c",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "a34391d7e308dacdc22e6d02a503e04eb0f43b9d0934253b57ca7d984edb83ae"
  },
  "id": "ID_PLACEHOLDER",
  "tags": []
}